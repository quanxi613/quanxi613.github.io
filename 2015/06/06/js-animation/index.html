
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JS动画基础 | quanxi613的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="最近看到了一篇介绍JS动画的好文章，就把文章进行翻译总结后放在这里。
动画基础JS动画实质上就是通过连续的改变DOM元素的styles或者canvas对象来达到动的效果。
整个动画过程可以拆分成几小部分，每部分通过定时器timer控制，由于timer的时间间隔非常短，所以看起来就是一个连续的动画。
1234var id = setInterval(function() &amp;#123;    /* s">
<meta property="og:type" content="article">
<meta property="og:title" content="JS动画基础">
<meta property="og:url" content="http://quanxi613.github.io/2015/06/06/js-animation/index.html">
<meta property="og:site_name" content="quanxi613的博客">
<meta property="og:description" content="最近看到了一篇介绍JS动画的好文章，就把文章进行翻译总结后放在这里。
动画基础JS动画实质上就是通过连续的改变DOM元素的styles或者canvas对象来达到动的效果。
整个动画过程可以拆分成几小部分，每部分通过定时器timer控制，由于timer的时间间隔非常短，所以看起来就是一个连续的动画。
1234var id = setInterval(function() &amp;#123;    /* s">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/linear-height.png">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/quad-height.png">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/linear.png">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/quad.png">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/circ.png">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/back.png">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/elastic.png">
<meta property="og:image" content="http://7xjckw.com1.z0.glb.clouddn.com/bounce-inout.png">
<meta property="og:updated_time" content="2015-06-06T16:25:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JS动画基础">
<meta name="twitter:description" content="最近看到了一篇介绍JS动画的好文章，就把文章进行翻译总结后放在这里。
动画基础JS动画实质上就是通过连续的改变DOM元素的styles或者canvas对象来达到动的效果。
整个动画过程可以拆分成几小部分，每部分通过定时器timer控制，由于timer的时间间隔非常短，所以看起来就是一个连续的动画。
1234var id = setInterval(function() &amp;#123;    /* s">
  
    <link rel="alternative" href="/atom.xml" title="quanxi613的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
  
<!-- baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f5426eb8e9063d338b5650a92e8690aa";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- End baidu Analytics -->

</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">    
    <div id="header-title" class="inner">     
      <h1 id="logo-wrap">
        <a href="/" id="logo">quanxi613的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="http://quanxi613.github.io/demo">demo</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/quanxi613" target="_blank" title="github"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="quanxi613.github.io">
        </form>
      </div>
    </div>
    <a href="#" class="avatar-wrap">
      <img src="/img/avatar.jpg" class="avatar" alt="">
    </a>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-js-animation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/06/js-animation/" class="article-date">
  <time datetime="2015-06-05T16:00:00.000Z" itemprop="datePublished">2015-06-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JS动画/">JS动画</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JS动画基础
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近看到了一篇介绍JS动画的好文章，就把文章进行翻译总结后放在这里。</p>
<h2 id="动画基础">动画基础</h2><p>JS动画实质上就是通过连续的改变DOM元素的<code>styles</code>或者canvas对象来达到动的效果。</p>
<p>整个动画过程可以拆分成几小部分，每部分通过定时器<code>timer</code>控制，由于<code>timer</code>的时间间隔非常短，所以看起来就是一个连续的动画。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> id = setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* show the current frame */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="comment">/* finished */</span>) clearInterval(id)       </span><br><span class="line">&#125;, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>代码中，帧和帧之间的delay是<code>10ms</code>，即每秒100帧</p>
<p>多数JS框架中，默认是<code>10-15ms</code>，较少的delay会让动画看起来更流畅更平滑，当然这是要求浏览器能够足够快，以满足按时完成每步的动画。</p>
<p>如果一个动画需要很多计算，CPU会100%load，那么反应会变得非常迟钝，这种情况下，就需要增加delay的值了。举个例子，<code>40ms</code>相当于每秒25帧，已经接近相机标准24帧了。</p>
<h2 id="动画代码重构">动画代码重构</h2><p>为了让animation更具一般化，需要下面的这些参数：</p>
<h4 id="delay">delay</h4><p>帧之间的时间，单位<code>ms</code></p>
<h4 id="duration">duration</h4><p>整个动画持续的时间，单位<code>ms</code></p>
<h4 id="start">start</h4><p>动画开始的时间，<code>start = new Date</code></p>
<hr>
<p>下面就是动画过程的核心部分了，每帧都需要计算的参数：</p>
<h4 id="timePassed">timePassed</h4><p>从动画开始经过的时间，单位<code>ms</code>，通常范围是0~<code>duration</code>之间，可能在浏览器timer不准确的情况下，偶尔会超过<code>duration</code>的值。</p>
<h4 id="progress">progress</h4><p>小数，表示动画已经进行了多久，计算方式<code>timePassed/duration</code>，通常范围是0~1之间。比如<code>progress = 0.5</code>表示已经过去了<code>duration</code>的一般时间了。</p>
<h4 id="delta(progress)">delta(progress)</h4><p>function，返回当前动画的progress。比如，让属性<code>height</code>从0%增大到100%：</p>
<p>mapping：</p>
<ul>
<li><code>progress = 0</code>-&gt;<code>height = 0%</code></li>
<li><code>progress = 0.2</code>-&gt;<code>height = 20%</code></li>
<li><code>progress = 0.5</code>-&gt;<code>height = 50%</code></li>
<li><code>progress = 0.8</code>-&gt;<code>height = 80%</code></li>
<li><code>progress = 1</code>-&gt;<code>height = 100%</code></li>
</ul>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/linear-height.png" alt=""></p>
<p>有时我们想让动画不是线性变换，而是开始慢，然后快，那么也可以是下面的情况</p>
<p>mapping：</p>
<ul>
<li><code>progress = 0</code>-&gt;<code>height = 0%</code></li>
<li><code>progress = 0.2</code>-&gt;<code>height = 4%</code></li>
<li><code>progress = 0.5</code>-&gt;<code>height = 25%</code></li>
<li><code>progress = 0.8</code>-&gt;<code>height = 64%</code></li>
<li><code>progress = 1</code>-&gt;<code>height = 100%</code></li>
</ul>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/quad-height.png" alt=""></p>
<p><code>delta(progress)</code>就是一个将时间进度<code>progress</code>映射到动画进度<code>delta</code>的函数，表明了<code>progress</code>和<code>delta</code>的映射关系。</p>
<h4 id="step(delta)">step(delta)</h4><p>function, 以<code>delta</code>作为参数</p>
<p>比如：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step</span><span class="params">(delta)</span> </span>&#123;</span><br><span class="line">  elem.style.height = <span class="number">100</span>*delta + <span class="string">'%'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结上面的主要参数：</p>
<ul>
<li><code>delay</code>就是<code>setInterval</code>的第二个参数</li>
<li><code>duration</code>指整个动画完成需要的时间</li>
<li><code>progress</code>指经过了多长时间，取值0~1之间</li>
<li><code>delta</code>计算动画的当前进度，前提是已知当前的时间</li>
<li><code>step</code>将当前的动画进度赋给元素</li>
</ul>
<h3 id="一个普通动画的例子">一个普通动画的例子</h3><p>将上面所讲的几个参数融合到一个动画函数里</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">opts</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>   </span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> id = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timePassed = <span class="keyword">new</span> <span class="built_in">Date</span> - start</span><br><span class="line">    <span class="keyword">var</span> progress = timePassed / opts.duration</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (progress &gt; <span class="number">1</span>) progress = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> delta = opts.delta(progress)</span><br><span class="line">    opts.step(delta)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (progress == <span class="number">1</span>) &#123;</span><br><span class="line">      clearInterval(id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, opts.delay || <span class="number">10</span>)</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上例中的<code>opts</code>需要包含如下属性：</p>
<ul>
<li><code>delay</code></li>
<li><code>duration</code></li>
<li>function <code>delta</code></li>
<li>function <code>step</code></li>
</ul>
<p>在上例的基础上，写一个动画函数move</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">move</span><span class="params">(element, delta, duration)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> to = <span class="number">500</span></span><br><span class="line">  </span><br><span class="line">  animate(&#123;</span><br><span class="line">    delay: <span class="number">10</span>,</span><br><span class="line">    duration: duration || <span class="number">1000</span>, <span class="comment">// 1 sec by default</span></span><br><span class="line">    delta: delta,</span><br><span class="line">    step: <span class="function"><span class="keyword">function</span><span class="params">(delta)</span> </span>&#123;</span><br><span class="line">      element.style.left = to*delta + <span class="string">"px"</span>    </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> onclick=<span class="string">"move(this.children[0], function(p) &#123;return p&#125;)"</span> <span class="type">class</span>=<span class="string">"example_path"</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"example_block"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure>
<p><code>delta = function(p) {return p}</code>表示动画进度在时间上是匀速的</p>
<p>效果是<a href="http://quanxi613.github.io/demo/js-animation/js-animation.html" target="_blank">demo</a>中的第一种情况</p>
<h2 id="delta函数"><code>delta</code>函数</h2><p>动画根据给定的规则随时间变化，而这个规则由<code>delta</code>函数来实现。</p>
<p>不同的<code>delta</code>函数让动画的速度，准确度以及其他参数有多种表现形式，函数里通常是一个数学公式。</p>
<p>下面举几个非常常用的公式：</p>
<p>注：下面所有delta函数的对应效果均可在<a href="http://quanxi613.github.io/demo/js-animation/js-animation.html" target="_blank">demo</a>中查看。</p>
<h4 id="linear_delta">linear <code>delta</code></h4><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">linear</span><span class="params">(progress)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> progress</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数学图形如下：</p>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/linear.png" alt=""></p>
<p>横轴是<code>progress</code>，纵轴是<code>delta(progress)</code>。动画的速度是固定值，也就是匀速运动。</p>
<h4 id="power_of_n">power of <code>n</code></h4><p><code>delta</code>是<code>progress</code>的n次方</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quad</span>(<span class="params">progress</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.pow(progress, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/quad.png" alt=""></p>
<h4 id="Circ:_a_piece_of_circle">Circ: a piece of circle</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">circ</span>(<span class="params">progress</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - <span class="built_in">Math</span>.sin(<span class="built_in">Math</span>.acos(progress)) <span class="comment">//Math.acos()返回一个数的反余弦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/circ.png" alt=""></p>
<h4 id="Back:_the_bow_function_弯曲函数">Back: the bow function 弯曲函数</h4><p>这个函数会先后退，然后加速前进</p>
<p>与之前的函数不同，这个函数依赖一个额外的参数x，叫做弹性系数</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">back</span><span class="params">(progress, x)</span> &#123;</span></span><br><span class="line">    return Math.<span class="built_in">pow</span><span class="params">(progress, <span class="number">2</span>)</span> <span class="built_in">*</span> <span class="params">(<span class="params">(x + <span class="number">1</span>)</span> * progress - x)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>x = 1.5</code>时的图形</p>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/back.png" alt=""></p>
<h4 id="Bounce_弹跳">Bounce 弹跳</h4><p>这个效果可以想象成一个球掉到地板上，然后弹跳的效果</p>
<p>在达到一个目标点时停止弹跳</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bounce</span><span class="params">(progress)</span> &#123;</span></span><br><span class="line">  <span class="keyword">for</span><span class="params">(var a = <span class="number">0</span>, b = <span class="number">1</span>, result; <span class="number">1</span>; a += b, b /= <span class="number">2</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(progress &gt;= <span class="params">(<span class="number">7</span> - <span class="number">4</span> * a)</span> / <span class="number">11</span>)</span> &#123;</span><br><span class="line">      return -Math.<span class="built_in">pow</span><span class="params">(<span class="params">(<span class="number">11</span> - <span class="number">6</span> * a - <span class="number">11</span> * progress)</span> / <span class="number">4</span>, <span class="number">2</span>)</span> + Math.<span class="built_in">pow</span><span class="params">(b, <span class="number">2</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Elastic_弹性">Elastic 弹性</h4><p>这个函数也有一个额外的参数<code>x</code>，用来定义初始范围</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">elastic</span><span class="params">(progress, x)</span> &#123;</span></span><br><span class="line">  return Math.<span class="built_in">pow</span><span class="params">(<span class="number">2</span>, <span class="number">10</span> * <span class="params">(progress-<span class="number">1</span>)</span>)</span> <span class="built_in">*</span> Math.<span class="built_in">cos</span><span class="params">(<span class="number">20</span>*Math.<span class="literal">PI</span>*x/<span class="number">3</span>*progress)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>x = 1.5</code>时的数学图形为</p>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/elastic.png" alt=""></p>
<h2 id="Reverse_functions_逆函数">Reverse functions 逆函数</h2><p>直接使用上面总结的各种<code>delta</code>函数，均属于<code>easeIn</code>模式。</p>
<p>然而，有时候需要以time-reversed mode的方式来展示动画，这种叫做<code>easeOut</code>模式，通过“time-reversing”<code>delta</code>方式来控制。</p>
<h3 id="easeOut">easeOut</h3><p>在这个模式下，delta需要做转换：<code>deltaEaseOut = 1 - delta(1 - progress)</code>，然后将<code>deltaEaseOut</code>作为<code>delta</code>参数传入<code>move</code>函数。</p>
<p>举一个<code>bounce</code>在<code>easeOut</code>模式下的例子：</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bounce</span><span class="params">(progress)</span> &#123;</span></span><br><span class="line">  <span class="keyword">for</span><span class="params">(var a = <span class="number">0</span>, b = <span class="number">1</span>, result; <span class="number">1</span>; a += b, b /= <span class="number">2</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="params">(progress &gt;= <span class="params">(<span class="number">7</span> - <span class="number">4</span> * a)</span> / <span class="number">11</span>)</span> &#123;</span><br><span class="line">      return -Math.<span class="built_in">pow</span><span class="params">(<span class="params">(<span class="number">11</span> - <span class="number">6</span> * a - <span class="number">11</span> * progress)</span> / <span class="number">4</span>, <span class="number">2</span>)</span> + Math.<span class="built_in">pow</span><span class="params">(b, <span class="number">2</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeEaseOut</span><span class="params">(delta)</span> &#123;</span>  </span><br><span class="line">  return <span class="function"><span class="keyword">function</span><span class="params">(progress)</span> &#123;</span></span><br><span class="line">    return <span class="number">1</span> - delta<span class="params">(<span class="number">1</span> - progress)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var bounceEaseOut = makeEaseOut<span class="params">(bounce)</span>;</span><br></pre></td></tr></table></figure>
<p>我们通过下图来看一下<code>easeOut</code>是如何变化的：</p>
<p><img src="http://7xjckw.com1.z0.glb.clouddn.com/bounce-inout.png" alt=""></p>
<p>红线是easeIn(normal)，绿线是easeOut(time-reversed)</p>
<ul>
<li>easeIn的情况下，开始会在底部缓慢弹跳，然后弹到最高处</li>
<li>easeOut模式下，会在瞬间弹至顶端，然后缓慢在底部弹跳</li>
</ul>
<p>可以看出<code>easeOut</code>会造成time-reversed，即时间反转。</p>
<h3 id="easeInOut">easeInOut</h3><p>另外一种情况就是在动画的开始和结束都出现<code>delta</code>定义的效果，这种就是<code>easeInOut</code>。</p>
<p>转换过程如下：</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeEaseInOut</span><span class="params">(delta)</span> &#123;</span>  </span><br><span class="line">  return <span class="function"><span class="keyword">function</span><span class="params">(progress)</span> &#123;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="params">(progress &lt; .<span class="number">5</span>)</span>  <span class="comment">//动画的前半段</span></span><br><span class="line">      return delta<span class="params">(<span class="number">2</span>*progress)</span> / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span>  <span class="comment">//动画的后半段</span></span><br><span class="line">      return <span class="params">(<span class="number">2</span> - delta<span class="params">(<span class="number">2</span>*<span class="params">(<span class="number">1</span>-progress)</span>)</span>)</span> / <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bounceEaseInOut = makeEaseInOut<span class="params">(bounce)</span>;</span><br></pre></td></tr></table></figure>
<p>上面的变换过程把<code>easeIn</code>和<code>easeOut</code>结合到了一起。</p>
<p>总结：</p>
<ul>
<li>easeIn 最基本的表现：开始缓慢，然后加速</li>
<li>easeOut 表现为time-reversed，开始很快，然后越来越慢</li>
<li>easeInOut 上面两种情况的混合，动画被拆分为两半，第一部分是easeIn，第二部分是easeOut</li>
</ul>
<h2 id="改变step">改变<code>step</code></h2><p>可以任意改变<code>step</code>来做各种动画，opcity,width,height,color…都可以做动画。</p>
<h3 id="Color_highlight">Color highlight</h3><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">highlight</span><span class="params">(elem)</span> &#123;</span></span><br><span class="line">  var from = [<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>], to = [<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>]</span><br><span class="line">  animate<span class="params">(&#123;</span><br><span class="line">    delay: <span class="number">10</span>,</span><br><span class="line">    duration: <span class="number">1000</span>,</span><br><span class="line">    delta: linear,</span><br><span class="line">    step: function<span class="params">(delta)</span> &#123;</span><br><span class="line">      elem.style.backgroundColor = 'rgb<span class="params">(' +</span><br><span class="line">        Math.max<span class="params">(Math.min<span class="params">(parseInt<span class="params">(<span class="params">(delta * <span class="params">(to[<span class="number">0</span>]-from[<span class="number">0</span>])</span>)</span> + from[<span class="number">0</span>], <span class="number">10</span>)</span>, <span class="number">255</span>)</span>, <span class="number">0</span>)</span> + ',' +</span><br><span class="line">        Math.max<span class="params">(Math.min<span class="params">(parseInt<span class="params">(<span class="params">(delta * <span class="params">(to[<span class="number">1</span>]-from[<span class="number">1</span>])</span>)</span> + from[<span class="number">1</span>], <span class="number">10</span>)</span>, <span class="number">255</span>)</span>, <span class="number">0</span>)</span> + ',' +</span><br><span class="line">        Math.max<span class="params">(Math.min<span class="params">(parseInt<span class="params">(<span class="params">(delta * <span class="params">(to[<span class="number">2</span>]-from[<span class="number">2</span>])</span>)</span> + from[<span class="number">2</span>], <span class="number">10</span>)</span>, <span class="number">255</span>)</span>, <span class="number">0</span>)</span> + ')</span>';</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="CSS_transitions">CSS transitions</h2><p>可以通过CSS transitions来实现一些简单的动画效果。</p>
<p>然而跟JS相比还是有局限性：</p>
<ul>
<li>在JS里，可以通过设置<code>delta</code>来使动画呈现不同的变化，CSS中也即<code>transition-timing-function</code>，然而CSS只支持3次Bézier曲线</li>
<li>只有CSS属性才能做为动画，当然比较好的地方在于，多个属性都可以同时设置动画</li>
</ul>
<p>所以如果是比较简单的动画可以采用CSS的方式来实现，比较省事儿</p>
<h2 id="优化提示">优化提示</h2><h4 id="较多的定时器会造成CPU过多的消耗">较多的定时器会造成CPU过多的消耗</h4><p>如果需要同时运行多个动画，比如下着的雪花，将他们放在一个单独的定时器里。</p>
<p>因为每个定时器都会对页面进行重绘，如果只有单独的一个重绘，那么浏览器效率会更高。</p>
<p>一个动画框架通常只有一个单独的<code>setInterval</code>，在它上面运行所有帧。</p>
<h4 id="帮助浏览器去渲染">帮助浏览器去渲染</h4><p>浏览器控制渲染树，元素之间互相依赖。</p>
<p>如果动画元素在DOM很深层的地方，那么其他元素就会依赖于其几何构造和位置。尽管动画没有移动他们，但浏览器不得不使用更多的额外计算。</p>
<p>解决方案：</p>
<ol>
<li>将原本放在DOM里的动画元素直接放到开始的<code>body</code>下，需要将其设置成绝对定位</li>
<li>加动画</li>
<li>将其重新放回DOM中</li>
</ol>
<p>这样可以减少动画的不稳定性，同时降低CPU的计算。</p>
<p>本文的demo示例均可在<a href="http://quanxi613.github.io/demo/js-animation/js-animation.html" target="_blank">这里</a>查看。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://quanxi613.github.io/2015/06/06/js-animation/" data-id="cibqkqgg10008ffxry2ui532b" class="article-share-link" data-share="baidu">分享到</a>
      

      
        <a href="http://quanxi613.github.io/2015/06/06/js-animation/#ds-thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/06/13/fe-tool-template/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          FE-tool-template
        
      </div>
    </a>
  
  
    <a href="/2015/05/31/svg-learning/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">SVG初探</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2015/06/06/js-animation/" data-title="JS动画基础" data-url="http://quanxi613.github.io/2015/06/06/js-animation/"></div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS动画/">JS动画</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SVG/">SVG</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jQuery/">jQuery</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客搭建/">博客搭建</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构搭建/">架构搭建</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/07/05/async-js/">JS异步编程</a>
          </li>
        
          <li>
            <a href="/2015/06/30/maintainable-javascript/">重构你的JS代码</a>
          </li>
        
          <li>
            <a href="/2015/06/13/fe-tool-template/">FE-tool-template</a>
          </li>
        
          <li>
            <a href="/2015/06/06/js-animation/">JS动画基础</a>
          </li>
        
          <li>
            <a href="/2015/05/31/svg-learning/">SVG初探</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://qiudeqing.com/" target="_blank">qiu的博客</a>
          </li>
        
          <li>
            <a href="http://lingyu.wang/" target="_blank">天镶的博客</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 quanxi613<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="http://quanxi613.github.io/demo" class="mobile-nav-link">demo</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"quanxi613"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>window._bd_share_config={"common":{},"share":{"bdCustomStyle":"/css/bdshare.css"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>

</div>
</body>
</html>
